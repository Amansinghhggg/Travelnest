// 1. ADD AVG STARS :-
// // Helper function
// async function updateAverageRating(listingId) {
//   const listing = await Listing.findById(listingId).populate('reviews');
//   if (listing.reviews.length > 0) {
//     const total = listing.reviews.reduce((sum, review) => sum + review.rating, 0);
//     listing.averageRating = (total / listing.reviews.length).toFixed(1);
//   } else {
//     listing.averageRating = 0;
//   }
//   await listing.save();
// }

// // In POST review route:
// app.post('/listings/:id/reviews', validatereview, wrapAsync(async (req, res, next) => {
//   const { id } = req.params;
//   const listing = await Listing.findById(id);
//   const review = new Review(req.body);
//   listing.reviews.push(review);
//   await review.save();
//   await listing.save();
//   await updateAverageRating(id); // Update average
//   res.redirect(`/listings/${id}`);
// }));

// // In DELETE review route:
// app.delete('/listings/:listingId/reviews/:reviewId', wrapAsync(async (req, res, next) => {
//   const { listingId, reviewId } = req.params;
//   await Listing.findByIdAndUpdate(listingId, { $pull: { reviews: reviewId } });
//   await Review.findByIdAndDelete(reviewId);
//   await updateAverageRating(listingId); // Update average
//   res.redirect(`/listings/${listingId}`);
// }));
